# Molecular evolution

## CODEML

Because HYPHY no longer infers dN and dS separately, we used CODEML from paml to estimate dN and dS for each species. CODEML was run in two modes:

1. Pairwise sequence comparison to calculate dN and dS **per species** with *Rehmannia_glutinosa* as the reference. This was done for both mitochondrial and plastid sequences. The codeml control file is `codeml_pairwise.ctl` and the input sequences are concatenated pairwise DNA alignment of the core 24 mito genes and 25 universally conserved pt genes.

2. Free-rate mode to calculate dN and dS **per branch** using a reference phylogeny `Orobanchaceae.codeml.tre`. The codeml control file is `codeml_free-rate.ctl`.

3. Passing and visualizing CODEML results. The R package treeio and ggtree provides handy functions to parse the mlc and rst files generated by CODEML. This includes dN, dS, codon usage, ancestral sequence reconstruction, etc. For example, I use the R script `codeml_hyphy_ggtree_plot.R` to plot phylogenies with branches color-coded by dN, dS, or dN/dS.

## RELAX selection in HYPHY

1. Use the command line version of HYPHY, RELAX can be applied with the following commands:
```
hyphy relax --code Universal --alignment mt.aln.fas --tree Orobanchaceae_oneholoclade.hyphy.tre  
```

2. The resulting `*.json` file can be parsed by the json module in Python to extract parameter estimations for each branch (e.g., k values for each branch under the general descriptive model). See script `hyphy_json_parsser.py`.
