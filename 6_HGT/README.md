# HGT identification
## Disclaimer
This version of HGTScanner was only used to detect HGTs in plant mitochondria using the methods described in the original paper. It was customized for Orobanchaceae. Liming is actively generalizing HGTScanner as a standalone tool for HGT detection. Check out the updates on this GitHub repository https://github.com/lmcai/HGTScanner.

## How to

HGTScanner_mt was used to identify homology, build phylogeny, and classify loci.

1. Prepare a bed file for coding regions and MTPT. These region will be masked due to excessive BLAST hits if queried against the NCBI nr/nt database for mitochondrial sequences. Use `gb2gff.py` to convert genbank formated annotation to gff and then to bed format.

See example from `mask.bed`. This file can include all regions that need to be masked across multiple species in the analysis.

2. Run HGTScanner to establish homologous regions for phylogenetic investigation. 

a. Make sure you have `Viridiplantae_mt.taxonomy` and `Viridiplantae_mt.fasta` in your working directory. This is the NCBI mito database. 

b. [optional] Add more mitochondrial genomes (e.g., `oro_mt.fas`) from close relatives to help distinguish VGT vs HGT. Any query sequences that cluster with these close relatives will be classified as VGT. 

c. Run HGTScanner

```
python HGTscanner_mt.py -q [query assembly] -ref oro_mt.fas -o [output prefix] -f Orobanchaceae -b mask.bed
```
You will see screen output like this:
```
2024-09-27 10:22:48.171531	Masking query sequence Lathraea_clandestina.fasta using the bed file: Lathraea_clandestina.mtpt.bed
2024-09-27 10:22:48.187107	Added custom reference all_mt.fas to the NCBI Viridiplantae mitochondrial database
2024-09-27 10:25:15.144927	BLAST completed for Lcl
2024-09-27 10:25:15.961650	Found 259 homologous genetic blocks for further examination
2024-09-27 10:25:45.576814	Extracting sequences from homologous genetic block #4

```
d. Output: This will generate a `[prefix].alnmap.bed` and a `[prefix]_HGTscanner_supporting_files` folder containing multiple fasta files of homologous regions

3. Sequence alignment and phylogeny

Use the following command to align sequence and infer phylogeny
```
mafft --localpair --maxiterate 1000 --quiet --adjustdirection [prefix].hgt.1.fas | sed 's/_R_//g' > [prefix].hgt.1.aln.fas
iqtree2 -B 1000 -T 4 -redo -s [prefix].hgt.1.aln.fas
```

4. Use `HGTclassifier.py` to classify VGT vs HGT

Navigate to the same folder where `[prefix].alnmap.bed` and `[prefix]_HGTscanner_supporting_files` are stored
```
python HGTclassifier.py [prefix]
```

This will generate a `[prefix].hgt.sum.tsv` file will all information.

# Statistical test for random distributtion of HGT

Use the distance to the nearest neighbour to evaluate whether HGTs are randomly distributed. The empirical distribution is compared to a null simulated form 10000 random distribution assuming same number of HGTs in the genome of the same size. A p-value is generated by chi-square test using  combined chi-square p-values based on the distribution of both mean and variance using Fisher's method.

To implement this, use the following command:
```
python HGT_nearest_neighbour_distribution.py Afa.hgt.sum.tsv
```
